# Context Module Definitions
# Defines which documents to load for different scenarios

version: "1.0"
last_updated: "2025-10-22"

# Context Modules
# Each module is a logical grouping of documents for specific use cases

modules:
  # New developer onboarding
  onboarding:
    id: "onboarding"
    purpose: "Everything a new developer needs to start"
    documents:
      - ORIGIN
      - INDEX
      - INSTALL
    estimated_tokens: 3100
    max_tokens: 4000
    dependencies: []
    auto_load: true
    use_cases:
      - "First time setup"
      - "New team member onboarding"
      - "Environment troubleshooting"
    
  # Daily development workflow
  development:
    id: "development"
    purpose: "Information for daily coding tasks"
    documents:
      - HACKING
      - ARCHITECTURE
      - ADR-001
      - ADR-002
    estimated_tokens: 5200
    max_tokens: 8000
    dependencies: ["onboarding"]
    auto_load: false
    use_cases:
      - "Writing code"
      - "Running tests"
      - "Understanding codebase"
      - "Code review"
    
  # Deep architectural understanding
  deep_dive:
    id: "deep_dive"
    purpose: "Deep understanding of system architecture"
    documents:
      - ARCHITECTURE
      - ADR-001
      - ADR-002
      - ADR-003
    estimated_tokens: 5500
    max_tokens: 10000
    dependencies: ["onboarding"]
    auto_load: false
    use_cases:
      - "Architecture review"
      - "Performance optimization"
      - "Major refactoring"
      - "Design discussions"
    
  # Troubleshooting and debugging
  troubleshooting:
    id: "troubleshooting"
    purpose: "Resolve common issues quickly"
    documents:
      - INSTALL  # troubleshooting section
      - ADR-003  # DNS issues
    estimated_tokens: 2800
    max_tokens: 4000
    dependencies: []
    auto_load: false
    use_cases:
      - "Environment not working"
      - "DNS resolution failures"
      - "Container issues"
      - "Build failures"
    
  # Project maintenance
  maintenance:
    id: "maintenance"
    purpose: "Project maintenance and history"
    documents:
      - CHANGELOG
      - ORIGIN
    estimated_tokens: 1500
    max_tokens: 3000
    dependencies: []
    auto_load: false
    use_cases:
      - "Release planning"
      - "Change review"
      - "Understanding history"

# Loading Strategies
strategies:
  # Lazy loading (default)
  lazy:
    description: "Load modules only when explicitly needed"
    auto_load_modules: ["onboarding"]
    load_on_demand: true
    max_total_tokens: 50000
    
  # Eager loading (comprehensive analysis)
  eager:
    description: "Load multiple modules upfront"
    auto_load_modules: ["onboarding", "development"]
    load_on_demand: true
    max_total_tokens: 100000
    
  # Minimal (quick queries)
  minimal:
    description: "Load only essential context"
    auto_load_modules: []
    load_on_demand: true
    max_total_tokens: 10000

# Query to Module Mapping
# Helps AI decide which module to load based on query
query_patterns:
  setup_related:
    keywords: ["install", "setup", "environment", "docker", "wsl2"]
    module: "onboarding"
    
  development_related:
    keywords: ["build", "compile", "test", "code", "develop"]
    module: "development"
    
  architecture_related:
    keywords: ["architecture", "design", "yijinjing", "wingchun", "how does", "why"]
    module: "deep_dive"
    
  problem_related:
    keywords: ["error", "fail", "not working", "dns", "issue", "problem"]
    module: "troubleshooting"

# Usage Examples
examples:
  - query: "How do I set up the development environment?"
    recommended_modules: ["onboarding"]
    estimated_tokens: 3100
    
  - query: "How does the event system work?"
    recommended_modules: ["development", "deep_dive"]
    estimated_tokens: 8000
    
  - query: "DNS resolution is failing"
    recommended_modules: ["troubleshooting"]
    estimated_tokens: 2800
    
  - query: "Why did we choose Docker over VM?"
    recommended_modules: ["deep_dive"]
    estimated_tokens: 5500
    
  - query: "I want to contribute code"
    recommended_modules: ["onboarding", "development"]
    estimated_tokens: 6600

# Optimization Rules
optimization:
  # Remove duplicate content when loading multiple modules
  deduplicate: true
  
  # Prefer code examples over prose
  code_over_prose: false
  
  # Load dependencies automatically
  auto_load_dependencies: true
  
  # Maximum context budget (tokens)
  max_total_tokens: 100000
  
  # Warning threshold (80% of max)
  warning_threshold: 80000

# Validation
validation:
  check_circular_deps: true
  check_document_existence: true
  check_token_limits: true
  check_dependency_order: true

